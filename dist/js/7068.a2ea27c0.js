(self["webpackChunkui_plugin_examples"]=self["webpackChunkui_plugin_examples"]||[]).push([[7068],{77068:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>O});var a=r(20641),s=r(90033);function o(e,t,r,o,l,n){const c=(0,a.g2)("ExplorerMembers");return(0,a.uX)(),(0,a.Wv)(c,(0,s._B)((0,a.Ng)(e.$attrs)),null,16)}const l={class:"project-members"},n={key:0,class:"row mb-10 cluster-add"},c={class:"group-bar"},i={class:"group-tab"},d={class:"project-name"},u={class:"right"},p=["data-testid","onClick"],m=["data-testid"],h=["onClick"],g=["data-testid","onClick"],b={class:"main-row"},T={class:"empty text-center",colspan:"100%"};function R(e,t,r,o,R,j){const v=(0,a.g2)("Masthead"),P=(0,a.g2)("Banner"),E=(0,a.g2)("router-link"),L=(0,a.g2)("ResourceTable"),f=(0,a.g2)("Tab"),C=(0,a.g2)("SortableTable"),_=(0,a.g2)("Tabbed"),I=(0,a.gN)("clean-html"),M=(0,a.gN)("trim-whitespace");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.bF)(v,{schema:R.schema,resource:R.resource,"favorite-resource":R.VIRTUAL_TYPES.CLUSTER_MEMBERS,"create-location":R.createLocation,"create-button-label":e.t("members.createActionLabel"),"is-creatable":!1,"type-display":e.t("members.clusterAndProject")},null,8,["schema","resource","favorite-resource","create-location","create-button-label","type-display"]),t[6]||(t[6]=(0,a.eW)()),j.isLocal?((0,a.uX)(),(0,a.Wv)(P,{key:0,color:"error",label:e.t("members.localClusterWarning")},null,8,["label"])):(0,a.Q3)("",!0),t[7]||(t[7]=(0,a.eW)()),(0,a.bF)(_,null,{default:(0,a.k6)((()=>[(0,a.bF)(f,{name:"cluster-membership",label:e.t("members.clusterMembership")},{default:(0,a.k6)((()=>[j.canEditClusterMembers?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(E,{to:R.createLocation,class:"btn role-primary pull-right"},{default:(0,a.k6)((()=>[(0,a.eW)((0,s.v_)(e.t("members.createActionLabel")),1)])),_:1},8,["to"])])):(0,a.Q3)("",!0),t[0]||(t[0]=(0,a.eW)()),(0,a.bF)(L,{schema:R.schema,headers:R.headers,rows:j.filteredClusterRoleTemplateBindings,groupable:!0,"show-grouping":!0,namespaced:!1,loading:e.$fetchState.pending||!e.currentCluster||R.loadingClusterBindings,"sub-search":"subSearch","sub-fields":["nameDisplay"]},null,8,["schema","headers","rows","loading"])])),_:1,__:[0]},8,["label"]),t[5]||(t[5]=(0,a.eW)()),j.canManageProjectMembers&&!j.isHarvester?((0,a.uX)(),(0,a.Wv)(f,{key:0,name:"project-membership",label:e.t("members.projectMembership")},{default:(0,a.k6)((()=>[(0,a.bF)(C,{"group-by":"projectId",loading:e.$fetchState.pending||!e.currentCluster||R.loadingProjectBindings,rows:j.rowsWithFakeProjects,headers:R.projectRoleTemplateColumns,"table-actions":!1,"row-actions":!1},(0,a.eX)({"group-by":(0,a.k6)((r=>[(0,a.Lk)("div",c,[(0,a.bo)(((0,a.uX)(),(0,a.CE)("div",i,[(0,a.bo)((0,a.Lk)("div",d,null,512),[[I,j.getProjectLabel(r)]])])),[[M]]),t[1]||(t[1]=(0,a.eW)()),(0,a.Lk)("div",u,[j.canEditProjectMembers?((0,a.uX)(),(0,a.CE)("button",{key:0,type:"button",class:"btn btn-sm role-secondary mr-10 right","data-testid":`add-project-member-${j.getProjectLabel(r).replace(" ","").toLowerCase()}`,onClick:e=>j.addProjectMember(r)},(0,s.v_)(e.t("members.createActionLabel")),9,p)):(0,a.Q3)("",!0)])])])),"cell:role":(0,a.k6)((({row:e})=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.allRoles,((r,o)=>((0,a.uX)(),(0,a.CE)("span",{key:o,ref_for:!0,ref:"value","data-testid":`role-value-${o}`,class:"role"},[(0,a.Lk)("span",{class:(0,s.C4)(["role-value",{"text-link-enabled":e.canViewInApi}]),onClick:t=>j.viewRoleInAPI(e,r)},(0,s.v_)(r.nameDisplay),11,h),t[2]||(t[2]=(0,a.eW)()),(0,a.Lk)("i",{class:"icon icon-close","data-testid":`role-values-close-${o}`,onClick:t=>j.removeRole(e,r,t)},null,8,g)],8,m)))),128))])),_:2},[(0,a.pI)(j.projectsWithoutRoles,((t,r)=>({name:j.slotName(t),fn:(0,a.k6)((()=>[(0,a.Lk)("tr",b,[(0,a.Lk)("td",T,(0,s.v_)(e.t("members.noRolesAssigned")),1)])]))})))]),1032,["loading","rows","headers"])])),_:1},8,["label"])):(0,a.Q3)("",!0)])),_:1,__:[5]})])}var j=r(55823),v=r(1822),P=r(21399),E=r(31645),L=r(15553),f=r(54633),C=r(70209),_=r(13320),I=r(82887),M=r(66278),k=r(64619),y=r(47170),A=r(71883);const B={name:"ExplorerMembers",components:{Banner:f.A,Masthead:P.A,ResourceTable:v.A,Tabbed:C.A,Tab:_.A,SortableTable:I.A},props:{createLocationOverride:{type:Object,default:()=>({name:"c-cluster-product-resource-create",params:{resource:j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING}})}},async fetch(){const e=this.$store.getters["rancher/schemaFor"](j.k$.CLUSTER_ROLE_TEMPLATE_BINDING),t=this.$store.getters["rancher/schemaFor"](j.k$.PROJECT_ROLE_TEMPLATE_BINDING);this["normanClusterRTBSchema"]=e,this["normanProjectRTBSchema"]=t,e&&Promise.all([this.$store.dispatch("rancher/findAll",{type:j.k$.CLUSTER_ROLE_TEMPLATE_BINDING},{root:!0}),this.$store.dispatch("management/findAll",{type:j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING})]).then((([e])=>{this["normanClusterRoleTemplateBindings"]=e,this.loadingClusterBindings=!1})),t&&this.$store.dispatch("rancher/findAll",{type:j.k$.PROJECT_ROLE_TEMPLATE_BINDING},{root:!0}).then((e=>{this["projectRoleTemplateBindings"]=e,this.loadingProjectBindings=!1})),this.$store.dispatch("management/findAll",{type:j.Mc.PROJECT}).then((e=>this["projects"]=e));const r={normanPrincipals:this.$store.dispatch("rancher/findAll",{type:j.k$.PRINCIPAL}),mgmt:this.$store.dispatch("management/findAll",{type:j.Mc.USER}),mgmtRoleTemplates:this.$store.dispatch("management/findAll",{type:j.Mc.ROLE_TEMPLATE})};await(0,y.kR)(r)},data(){return{schema:this.$store.getters["management/schemaFor"](j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING),headers:[E.c4,E.nv,E.z7,E.K],createLocation:{...this.createLocationOverride,params:{...this.createLocationOverride.params,cluster:this.$store.getters["currentCluster"].id}},resource:j.Mc.CLUSTER_ROLE_TEMPLATE_BINDING,normanClusterRTBSchema:null,normanProjectRTBSchema:null,normanClusterRoleTemplateBindings:[],projectRoleTemplateBindings:[],projects:[],VIRTUAL_TYPES:j.cG,projectRoleTemplateColumns:[E.c4,{name:"member",labeKey:"generic.name",value:"principalId",formatter:"Principal"},{name:"role",labelKey:"tableHeaders.role",value:"roleTemplate.nameDisplay"}],loadingProjectBindings:!0,loadingClusterBindings:!0}},computed:{...(0,M.L8)(["currentCluster"]),clusterRoleTemplateBindings(){return this.normanClusterRoleTemplateBindings.map((e=>e.clusterroletemplatebinding))},filteredClusterRoleTemplateBindings(){return this.clusterRoleTemplateBindings.filter((e=>e?.clusterName===this.$store.getters["currentCluster"].id))},filteredProjects(){return this.projects.reduce(((e,t)=>(t?.spec?.clusterName===this.currentCluster.id&&(e[t.id]=t),e)),{})},filteredProjectRoleTemplateBindings(){const e=this.projectRoleTemplateBindings.filter((e=>{const t=e.projectId.replace(":","/");return!!this.filteredProjects[t]}));return e},projectsWithoutRoles(){const e=this.filteredProjectRoleTemplateBindings.reduce(((e,t)=>{const r=(t.projectId||"").replace(":","/");return e.includes(r)||e.push(r),e}),[]);return Object.keys(this.filteredProjects).reduce(((t,r)=>{const a=this.filteredProjects[r];return e.includes(r)||t.push(a),t}),[])},rowsWithFakeProjects(){const e=this.projectsWithoutRoles.map((e=>({groupByLabel:`resourceTable.groupLabel.notInAProject-${e.id}`,isFake:!0,mainRowKey:e.id,nameDisplay:e.spec?.displayName,project:e,availableActions:[],projectId:e.id}))),t=[...e,...this.filteredProjectRoleTemplateBindings].reduce(((e,t)=>{const{userId:r,groupPrincipalId:a,roleTemplate:s,projectId:o}=t,l=r||a;if(!l)return e;const n=l+o;return e[n]||(e[n]=t,e[n].allRoles=[]),s&&e[n].allRoles.push(t.roleTemplate),e}),{});return Object.values(t)},canManageMembers(){return(0,L.J)(this.$store)},canManageProjectMembers(){return(0,k.A)(this.$store)},isLocal(){return this.$store.getters["currentCluster"].isLocal},canEditProjectMembers(){return this.normanProjectRTBSchema?.collectionMethods.find((e=>"post"===e.toLowerCase()))},canEditClusterMembers(){return this.normanClusterRTBSchema?.collectionMethods.find((e=>"post"===e.toLowerCase()))},isHarvester(){return this.$store.getters["currentProduct"].inStore===A.T3}},methods:{getMgmtProjectId(e){return e.group.key.replace(":","/")},getMgmtProject(e){return this.$store.getters["management/byId"](j.Mc.PROJECT,this.getMgmtProjectId(e))},getProjectLabel(e){return this.getMgmtProject(e)?.spec?.displayName},addProjectMember(e){this.$store.dispatch("cluster/promptModal",{component:"AddProjectMemberDialog",componentProps:{projectId:e.group.key.replace("/",":"),saveInModal:!0},modalSticky:!0})},getProjectRoleBinding(e,t){const r=e.userId?"userId":"groupPrincipalId";return this.projectRoleTemplateBindings.find((a=>a.projectId===e.projectId&&a.roleTemplateId===t.id&&a[r]===e[r]))},async removeRole(e,t,r){const a=this.getProjectRoleBinding(e,t);await a.promptRemove()},viewRoleInAPI(e,t){const r=this.getProjectRoleBinding(e,t);r?.canViewInApi&&r.viewInApi()},slotName(e){return`main-row:${e.id}`}}};r(70345);var $=r(66262);const w=(0,$.A)(B,[["render",R],["__scopeId","data-v-52a613ce"]]),N=w,S={components:{ExplorerMembers:N}},x=(0,$.A)(S,[["render",o]]),O=x},19227:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(31601),s=r.n(a),o=r(76314),l=r.n(o),n=r(5111),c=l()(s());c.i(n.A),c.push([e.id,".role[data-v-52a613ce]{align-items:center;background-color:rgba(0,0,0,.05);border:1px solid var(--header-border);border-radius:5px;color:var(--tag-text);line-height:20px;padding:2px 5px;white-space:nowrap;display:inline-flex;margin-right:3px}.role-value.text-link-enabled[data-v-52a613ce]{cursor:pointer}.role-value.text-link-enabled[data-v-52a613ce]:hover{color:var(--primary)}.role-value+.icon-close[data-v-52a613ce]{margin-left:3px;cursor:pointer}.role-value+.icon-close[data-v-52a613ce]:hover{color:var(--primary)}.project-members[data-v-52a613ce]  .group-bar{display:flex;justify-content:space-between}.cluster-add[data-v-52a613ce]{justify-content:flex-end}",""]);const i=c},70345:(e,t,r)=>{var a=r(19227);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var s=r(99548).A;s("4b092fb9",a,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=7068.a2ea27c0.js.map