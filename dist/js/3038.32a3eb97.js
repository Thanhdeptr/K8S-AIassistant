"use strict";(self["webpackChunkui_plugin_examples"]=self["webpackChunkui_plugin_examples"]||[]).push([[262,3038],{53038:(e,t,r)=>{r.d(t,{A:()=>N});var s=r(66278),i=r(46405),a=r(96676),n=r(86691),o=r(18727),h=r(47441),c=r(30262),l=r(13970),u=r(55823),p=r(75317),d=r(66245),m=r.n(d),g=r(67130),v=r(6826),f=r(2543),y=r(96763);const N={data(){return{version:null,versionInfo:null,versionInfoError:null,existing:null,ignoreWarning:!1,chart:null}},computed:{...(0,s.L8)(["currentCluster","isRancher"]),showPreRelease:(0,n.mapPref)(n.SHOW_PRE_RELEASE),repo(){return this.$store.getters["catalog/repo"]({repoType:this.query.repoType,repoName:this.query.repoName})},showReadme(){return!!this.versionInfo?.readme},hasReadme(){return!!this.versionInfo?.appReadme||!!this.versionInfo?.readme},mappedVersions(){const e=this.chart?.versions||[],t=this.targetVersion,r=this.currentCluster?.workerOSs,s=[];e.forEach((e=>{const t={label:e.version,version:e.version,originalVersion:e.version,shortLabel:e.version.length>16?`${e.version.slice(0,15)}...`:e.version,id:e.version,created:e.created,disabled:!1,keywords:e.keywords},i=(e?.annotations?.[a.W8.PERMITTED_OS]||g.LINUX).split(",");i.length>0&&m()(r,i).length>0&&(t.disabled=!0),1===i.length&&(t.label=this.t(`catalog.install.versions.${i[0]}`,{ver:e.version})),!this.showPreRelease&&(0,p.V1)(e.version)||s.push(t)}));const i=s.find((e=>e.id===t));i||s.unshift({label:t,originalVersion:t,shortLabel:t.length>16?`${t.slice(0,15)}...`:t,id:t,created:null,disabled:!1,keywords:[]});const n=s.find((e=>e.originalVersion===this.currentVersion));return n&&(n.label=this.t("catalog.install.versions.current",{ver:this.currentVersion})),s},filteredVersions(){return this.showPreRelease?this.mappedVersions:this.mappedVersions.filter((e=>!e.isPre))},query(){const e=this.$route.query;return{repoType:e[i.Eo],repoName:e[i.NO],chartName:e[i.RX],versionName:e[i.xv],appNamespace:e[i.CU]||"",appName:e[i.o_]||"",description:e[i.tC],hidden:e[i.RG],deprecated:e[i.GQ]}},showDeprecated(){return"true"===this.query.deprecated||this.query.deprecated===i.Qp},showHidden(){return this.query.hidden===i.Qp},warnings(){const e=[];if(this.existing);else{const t=(0,l.ao)(this.version?.annotations?.[a.W8.REQUESTS_CPU]||"0"),r=(0,l.ao)(this.version?.annotations?.[a.W8.REQUESTS_MEMORY]||"0"),s=this.currentCluster?.availableCpu,i=this.currentCluster?.availableMemory;null!==s&&s<t&&e.push(this.t("catalog.install.error.insufficientCpu",{need:Math.round(100*t)/100,have:Math.round(100*s)/100})),null!==i&&i<r&&e.push(this.t("catalog.install.error.insufficientMemory",{need:(0,l.Mo)(r,{increment:1024,suffix:"iB",firstSuffix:"B"}),have:(0,l.Mo)(i,{increment:1024,suffix:"iB",firstSuffix:"B"})}))}if(this.chart?.id===c.OPA_GATE_KEEPER_ID&&e.unshift(this.t("gatekeeperIndex.deprecated",{},!0)),this.existing&&this.existing.upgradeAvailable===g.APP_UPGRADE_STATUS.NOT_APPLICABLE){const t=this.existing?.spec?.chart?.metadata?.annotations?.[a.W8.MANAGED]||"Rancher";e.unshift(this.t("catalog.install.warning.managed",{name:this.existing.name,version:this.chart?this.query.versionName:null,manager:"true"===t?"Rancher":t},!0))}return e},requires(){const e=[],t=(this.version?.annotations?.[a.W8.REQUIRES_GVK]||"").split(/\s*,\s*/).filter((e=>!!e)).reverse();if(t.length)for(const r of t){if(this.$store.getters["catalog/isInstalled"]({gvr:r}))continue;const t=this.provider(r);if(t){const r=this.$router.resolve(this.chartLocation(!0,t)).href;e.push(this.t("catalog.install.error.requiresFound",{url:r,name:t.name},!0))}else e.push(this.t("catalog.install.error.requiresMissing",{name:r}))}return e},currentVersion(){return this.existing?.spec.chart.metadata.version},targetVersion(){return this.version?this.version.version:this.query.versionName},action(){return this.existing?this.currentVersion===this.targetVersion?"update":"upgrade":"install"},isChartTargeted(){return this.chart?.targetNamespace&&this.chart?.targetName},hasQuestions(){return this.versionInfo&&!!this.versionInfo.questions}},methods:{fetchStoreChart(){return!this.chart&&this.repo&&this.query.chartName&&(this.chart=this.$store.getters["catalog/chart"]({repoType:this.query.repoType,repoName:this.query.repoName,chartName:this.query.chartName,includeHidden:!0,showDeprecated:this.showDeprecated})),this.chart},async fetchChart(){if(this.versionInfoError=null,await this.$store.dispatch("catalog/load"),this.fetchStoreChart(),this.query.appNamespace&&this.query.appName)try{this.existing=await this.$store.dispatch("cluster/find",{type:u.W8.APP,id:`${this.query.appNamespace}/${this.query.appName}`}),await(this.existing?.fetchValues(!0)),this.mode=i.G5}catch(e){this.mode=i.YQ,this.existing=null}else if(this.chart?.targetNamespace&&this.chart?.targetName)try{this.existing=await this.$store.dispatch("cluster/find",{type:u.W8.APP,id:`${this.chart.targetNamespace}/${this.chart.targetName}`}),this.mode=i.G5}catch(e){this.mode=i.YQ,this.existing=null}else this.mode=i.YQ;if(this.chart){if(!this.query.versionName&&this.chart.versions?.length)if(this.showPreRelease)this.query.versionName=this.chart.versions[0].version;else{const e=this.chart.versions.find((e=>!(0,p.V1)(e.version)));this.query.versionName=e?.version||this.chart.versions[0].version}if(this.query.versionName){try{this.version=this.$store.getters["catalog/version"]({repoType:this.query.repoType,repoName:this.query.repoName,chartName:this.query.chartName,versionName:this.query.versionName})}catch(e){y.error("Unable to fetch Version: ",e)}this.version||y.warn("No version found: ",this.query.repoType,this.query.repoName,this.query.chartName,this.query.versionName);try{this.versionInfo=await this.$store.dispatch("catalog/getVersionInfo",{repoType:this.query.repoType,repoName:this.query.repoName,chartName:this.query.chartName,versionName:this.query.versionName})}catch(e){this.versionInfoError=e,y.error("Unable to fetch VersionInfo: ",e)}}}},async fetchAutoInstallInfo(){const e=[],t=(this.version?.annotations?.[a.W8.AUTO_INSTALL]||"").split(/\s*,\s*/).filter((e=>!!e)).reverse();for(const s of t){const t=this.$store.getters["catalog/versionSatisfying"]({constraint:s,repoName:this.chart.repoName,repoType:this.chart.repoType,chartVersion:this.version.version});if(t)try{const r=await this.$store.dispatch("catalog/getVersionInfo",{repoType:t.repoType,repoName:t.repoName,chartName:t.name,versionName:t.version});let s;if(this.mode===i.G5){const e=r?.chart?.annotations?.[a.W8.NAMESPACE],t=r?.chart?.annotations?.[a.W8.RELEASE_NAME];t&&e&&(s=await this.$store.dispatch("cluster/find",{type:u.W8.APP,id:`${e}/${t}`}))}if(s){await s.fetchValues(!0);const e=(0,v.clone)(s.values||{}),t=(0,v.clone)(s.chartValues||{});r.existingValues=e,r.allValues=(0,f.merge)(t,e)}else r.allValues=(0,v.clone)(r.values);e.push(r)}catch(r){y.error("Unable to fetch VersionInfo: ",r)}else this.errors.push(`This chart requires ${s} but no matching chart was found`)}this["autoInstallInfo"]=e},selectVersion({id:e}){this.$router.applyQuery({[i.xv]:e})},provider(e){return this.$store.getters["catalog/versionProviding"]({gvr:e,repoName:this.chart.repoName,repoType:this.chart.repoType})},chartLocation(e=!1,t){const r=t||{repoType:this.chart.repoType,repoName:this.chart.repoName,name:this.chart.chartName,version:this.query.versionName};return{name:e?"c-cluster-apps-charts-install":"c-cluster-apps-charts-chart",params:{cluster:this.$route.params.cluster,product:this.$store.getters["productId"]},query:{[i.Eo]:r.repoType,[i.NO]:r.repoName,[i.RX]:r.name,[i.xv]:r.version}}},appLocation(){return this.existing?.detailLocation||{name:"c-cluster-product-resource",params:{product:this.$store.getters["productId"],cluster:this.$store.getters["clusterId"],resource:u.W8.APP}}},clusterToolsLocation(){return{name:"c-cluster-explorer-tools",params:{product:o.NAME,cluster:this.$store.getters["clusterId"],resource:u.W8.APP}}},clustersLocation(){return{name:"c-cluster-product-resource",params:{cluster:this.$route.params.cluster,product:h.NAME,resource:u.qt.RANCHER_CLUSTER}}}}}},27731:(e,t,r)=>{r.d(t,{A:()=>u});var s=r(20641),i=r(90033);const a={class:"chart-heading"},n=["href"];function o(e,t,r,o,h,c){return(0,s.uX)(),(0,s.CE)("div",a,[(0,s.Lk)("h1",null,(0,i.v_)(e.t("chartHeading.overview")),1),(0,s.eW)(" "+(0,i.v_)(e.t("chartHeading.poweredBy"))+" ",1),(0,s.Lk)("a",{href:r.url,rel:"nofollow noopener noreferrer",target:"_blank"},(0,i.v_)(r.label),9,n)])}const h={props:{label:{type:String,required:!0},url:{type:String,required:!0}}};var c=r(66262);const l=(0,c.A)(h,[["render",o]]),u=l},30262:(e,t,r)=>{r.r(t),r.d(t,{OPA_GATE_KEEPER_ID:()=>d,default:()=>f});var s=r(20641);const i={key:1},a={class:"mb-10"};function n(e,t,r,n,o,h){const c=(0,s.g2)("Loading"),l=(0,s.g2)("ChartHeading"),u=(0,s.g2)("Banner"),p=(0,s.g2)("t"),d=(0,s.g2)("SortableTable"),m=(0,s.gN)("clean-html");return e.$fetchState.pending?((0,s.uX)(),(0,s.Wv)(c,{key:0})):((0,s.uX)(),(0,s.CE)("div",i,[(0,s.bF)(l,{label:e.t("gatekeeperIndex.poweredBy"),url:"https://github.com/open-policy-agent/gatekeeper"},null,8,["label"]),t[0]||(t[0]=(0,s.eW)()),(0,s.bF)(u,{color:"warning"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.Lk)("span",null,null,512),[[m,e.t("gatekeeperIndex.deprecated",{},!0)]])])),_:1}),t[1]||(t[1]=(0,s.eW)()),t[2]||(t[2]=(0,s.Lk)("div",{class:"spacer"},null,-1)),t[3]||(t[3]=(0,s.eW)()),(0,s.Lk)("div",a,[(0,s.Lk)("h2",null,[(0,s.bF)(p,{k:"gatekeeperIndex.violations"})])]),t[4]||(t[4]=(0,s.eW)()),(0,s.Lk)("div",null,[(0,s.bF)(d,{headers:o.headers,rows:o.violations,search:!1,"table-actions":!1,"row-actions":!1,paging:!0,"rows-per-page":10,"key-field":"id","group-by":"templateLink.text"},null,8,["headers","rows"])])]))}var o=r(27731),h=r(82887),c=r(14492),l=r(31645),u=r(55823),p=r(38928);const d="cluster/rancher-charts/rancher-gatekeeper",m={components:{ChartHeading:o.A,SortableTable:h.A,Banner:c.l,Loading:p.A},async fetch(){const e=this.constraint?[this.constraint]:await this.$store.dispatch("cluster/findAll",{type:u.CC.SPOOFED.CONSTRAINT});this.violations=e.map(((e,t)=>({id:t,constraintLink:{text:e.nameDisplay,to:e.detailLocation},templateLink:{text:e.kind,to:{name:"c-cluster-product-resource-id",params:{resource:"templates.gatekeeper.sh.constrainttemplate",id:e.kind.toLowerCase(),product:"gatekeeper"}}},count:e.totalViolations})))},data(e){return{headers:[l.H7,l.gi,l.Wz],violations:[]}}};var g=r(66262);const v=(0,g.A)(m,[["render",n]]),f=v}}]);
//# sourceMappingURL=3038.32a3eb97.js.map