{"version":3,"file":"js/dialog24.ae1bd532.js","mappings":"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","sources":["webpack://ui-plugin-examples/./node_modules/@rancher/shell/dialog/RotateEncryptionKeyDialog.vue","webpack://ui-plugin-examples/./node_modules/@rancher/shell/dialog/RotateEncryptionKeyDialog.vue?9535","webpack://ui-plugin-examples/./node_modules/@rancher/shell/dialog/RotateEncryptionKeyDialog.vue?9bec","webpack://ui-plugin-examples/./node_modules/@rancher/shell/dialog/RotateEncryptionKeyDialog.vue?5248"],"sourcesContent":["<script>\nimport { SNAPSHOT, NORMAN } from '@shell/config/types';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Card } from '@components/Card';\nimport { Banner } from '@components/Banner';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\n\nimport { sortBy } from '@shell/utils/sort';\nimport day from 'dayjs';\nimport { escapeHtml } from '@shell/utils/string';\nimport { DATE_FORMAT, TIME_FORMAT } from '@shell/store/prefs';\nimport { set } from '@shell/utils/object';\n\nexport default {\n  emits: ['close'],\n\n  components: {\n    Card,\n    AsyncButton,\n    Banner,\n  },\n\n  props: {\n    cluster: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    }\n  },\n\n  async fetch() {\n    if (!this.$store.getters['isRancher']) {\n      // This fetch function is getting snapshots, which are associated\n      // with cluster manager. Rancher Desktop doesn't come with cluster\n      // manager, so for Rancher Desktop we return nothing.\n      return [];\n    }\n\n    const etcdBackups = await this.getEtcdBackups();\n\n    if (etcdBackups.length > 0) {\n      const backups = sortBy(etcdBackups, ['created']).reverse();\n      const name = backups[0].id.split(':');\n      const createdDate = backups[0].created;\n\n      this.latestBackup = {\n        name: name[0],\n        date: this.getFormattedCreatedDate(createdDate)\n      };\n    }\n  },\n\n  data() {\n    return { errors: [], latestBackup: null };\n  },\n\n  methods: {\n    close(buttonDone) {\n      if (buttonDone && typeof buttonDone === 'function') {\n        buttonDone(true);\n      }\n      this.$emit('close');\n    },\n\n    async getEtcdBackups() {\n      if ( this.cluster.isRke1) {\n        let etcdBackups = await this.$store.dispatch('rancher/findAll', { type: NORMAN.ETCD_BACKUP });\n\n        etcdBackups = etcdBackups.filter((backup) => backup.clusterId === this.cluster.metadata.name);\n\n        return etcdBackups;\n      }\n\n      if (this.cluster.isRke2) {\n        let etcdBackups = await this.$store.dispatch('management/findAll', { type: SNAPSHOT });\n\n        etcdBackups = etcdBackups.filter((backup) => backup.clusterId === this.cluster.id);\n\n        return etcdBackups;\n      }\n\n      return [];\n    },\n\n    getFormattedCreatedDate(createdDate) {\n      const dateFormat = escapeHtml(this.$store.getters['prefs/get'](DATE_FORMAT));\n      const timeFormat = escapeHtml( this.$store.getters['prefs/get'](TIME_FORMAT));\n      const d = day(createdDate).format(dateFormat);\n      const t = day(createdDate).format(timeFormat);\n\n      return `${ d } ${ t }`;\n    },\n\n    async apply(buttonDone) {\n      const isRke2 = this.cluster.isRke2;\n\n      try {\n        if (isRke2) {\n          const currentGeneration = this.cluster.spec?.rkeConfig?.rotateEncryptionKeys?.generation || 0;\n\n          // To rotate the encryption keys, increment\n          // rkeConfig.rotateEncyrptionKeys.generation in the YAML.\n          set(this.cluster, 'spec.rkeConfig.rotateEncryptionKeys.generation', currentGeneration + 1);\n          await this.cluster.save();\n\n          this.close(buttonDone);\n        } else {\n          await this.cluster.mgmt.doAction('rotateEncryptionKey');\n\n          this.close(buttonDone);\n        }\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n        buttonDone(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Card\n    class=\"prompt-rotate\"\n    :show-highlight-border=\"false\"\n  >\n    <template #title>\n      <h4\n        v-clean-html=\"t('promptRotateEncryptionKey.title')\"\n        class=\"text-default-text\"\n      />\n    </template>\n\n    <template #body>\n      <div class=\"pl-10 pr-10\">\n        <Banner\n          color=\"warning\"\n          label-key=\"promptRotateEncryptionKey.warning\"\n        />\n\n        <div v-if=\"!$fetchState.pending\">\n          <p\n            v-if=\"latestBackup\"\n            class=\"pt-10 pb-10\"\n          >\n            {{ t('promptRotateEncryptionKey.description', latestBackup, true) }}\n          </p>\n          <Banner\n            v-else\n            color=\"error\"\n            label-key=\"promptRotateEncryptionKey.error\"\n          />\n        </div>\n      </div>\n    </template>\n\n    <template #actions>\n      <div class=\"buttons\">\n        <button\n          class=\"btn role-secondary mr-10\"\n          @click=\"close\"\n        >\n          {{ t('generic.cancel') }}\n        </button>\n\n        <AsyncButton\n          mode=\"rotate\"\n          :disabled=\"$fetchState.pending || !latestBackup\"\n          @click=\"apply\"\n        />\n\n        <Banner\n          v-for=\"(err, i) in errors\"\n          :key=\"i\"\n          color=\"error\"\n          :label=\"err\"\n        />\n      </div>\n    </template>\n  </Card>\n</template>\n<style lang='scss' scoped>\n  .prompt-rotate {\n    margin: 0;\n  }\n  .buttons {\n    display: flex;\n    justify-content: flex-end;\n    width: 100%;\n  }\n</style>\n","import { render } from \"./RotateEncryptionKeyDialog.vue?vue&type=template&id=697436f3&scoped=true\"\nimport script from \"./RotateEncryptionKeyDialog.vue?vue&type=script&lang=js\"\nexport * from \"./RotateEncryptionKeyDialog.vue?vue&type=script&lang=js\"\n\nimport \"./RotateEncryptionKeyDialog.vue?vue&type=style&index=0&id=697436f3&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-697436f3\"]])\n\nexport default __exports__","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../../css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../../vue-loader/dist/stylePostLoader.js!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../../xterm/css/xterm.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.prompt-rotate[data-v-697436f3]{margin:0}.buttons[data-v-697436f3]{display:flex;justify-content:flex-end;width:100%}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!../../../vue-loader/dist/stylePostLoader.js!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!../../../postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!../../../sass-loader/dist/cjs.js??clonedRuleSet-22.use[4]!../../../cache-loader/dist/cjs.js??ruleSet[0].use[0]!../../../vue-loader/dist/index.js??ruleSet[0].use[1]!./RotateEncryptionKeyDialog.vue?vue&type=style&index=0&id=697436f3&lang=scss&scoped=true\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"83d95c62\", content, true, {\"sourceMap\":false,\"shadowMode\":false});"],"names":["class","title","t","body","color","$fetchState","pending","latestBackup","actions","close","mode","disabled","apply","errors","err","i","key","label","emits","components","Card","AsyncButton","Banner","props","cluster","type","Object","default","fetch","this","$store","getters","etcdBackups","getEtcdBackups","length","backups","sort","reverse","name","id","split","createdDate","created","date","getFormattedCreatedDate","data","methods","buttonDone","$emit","isRke1","dispatch","ETCD_BACKUP","filter","backup","clusterId","metadata","isRke2","dateFormat","DATE_FORMAT","timeFormat","TIME_FORMAT","d","format","currentGeneration","spec","rkeConfig","rotateEncryptionKeys","generation","set","save","mgmt","doAction","__exports__","render","___CSS_LOADER_EXPORT___","push","module","content","__esModule","locals","exports","add"],"sourceRoot":""}