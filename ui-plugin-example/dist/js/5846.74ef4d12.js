(self["webpackChunkui_plugin_examples"]=self["webpackChunkui_plugin_examples"]||[]).push([[5846],{45846:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var o=a(20641),s=a(90033),n=a(53751);const i={class:"title-block mt-20 mb-40"},r={class:"mb-40"},l={class:"mb-20"},c={class:"full-width"},d={class:"mb-40"},u={class:"mb-20"},m={class:"resources-count-container"},p=["onClick"],f={colspan:"4"},h={class:"cluster-row"},b={scope:"row"};function g(e,t,a,g,v,y){const k=(0,o.g2)("AsyncButton");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",i,[(0,o.Lk)("div",null,[(0,o.bF)(k,{mode:"timing",class:"mr-20","data-testid":"diagnostics-generate-response-times",onClick:y.gatherResponseTimes},null,8,["onClick"]),t[0]||(t[0]=(0,o.eW)()),(0,o.bF)(k,{mode:"diagnostic","data-testid":"diagnostics-download-diagnostic-package",onClick:y.promptDownload},null,8,["onClick"])])]),t[19]||(t[19]=(0,o.eW)()),(0,o.Lk)("div",r,[(0,o.Lk)("h2",l,(0,s.v_)(e.t("about.diagnostic.systemInformation.subtitle")),1),t[4]||(t[4]=(0,o.eW)()),(0,o.Lk)("table",c,[t[2]||(t[2]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Type"),(0,o.eW)(),(0,o.Lk)("th",null,"Value")])],-1)),t[3]||(t[3]=(0,o.eW)()),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(v.systemInformation,((e,a)=>((0,o.uX)(),(0,o.CE)("tr",{key:a},[e.value.length?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("td",null,(0,s.v_)(e.label),1),t[1]||(t[1]=(0,o.eW)()),(0,o.Lk)("td",null,(0,s.v_)(e.value),1)],64)):(0,o.Q3)("",!0)])))),128))])])]),t[20]||(t[20]=(0,o.eW)()),(0,o.Lk)("div",d,[(0,o.Lk)("h2",u,(0,s.v_)(e.t("about.diagnostic.resourceCounts",{count:y.clusterCount})),1),t[18]||(t[18]=(0,o.eW)()),(0,o.Lk)("div",m,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(v.finalCounts,((e,a)=>((0,o.uX)(),(0,o.CE)("table",{key:a,class:"full-width"},[(0,o.Lk)("thead",{onClick:t=>y.toggleTable(e.id)},[(0,o.Lk)("tr",null,[(0,o.Lk)("th",f,[(0,o.Lk)("div",h,[(0,o.Lk)("span",null,[t[5]||(t[5]=(0,o.eW)("Cluster: ")),(0,o.Lk)("b",null,(0,s.v_)(e.name),1)]),t[9]||(t[9]=(0,o.eW)()),(0,o.Lk)("span",null,[t[6]||(t[6]=(0,o.eW)("Namespace: ")),(0,o.Lk)("b",null,(0,s.v_)(e.namespace),1)]),t[10]||(t[10]=(0,o.eW)()),(0,o.Lk)("span",null,[t[7]||(t[7]=(0,o.eW)("Total Resources: ")),(0,o.Lk)("b",null,(0,s.v_)(y.sumResourceCount(e.counts)),1)]),t[11]||(t[11]=(0,o.eW)()),(0,o.Lk)("span",null,[t[8]||(t[8]=(0,o.eW)("Nodes: ")),(0,o.Lk)("b",null,(0,s.v_)(y.nodeCount(e.counts)),1)]),t[12]||(t[12]=(0,o.eW)()),(0,o.Lk)("i",{class:(0,s.C4)(["icon",{"icon-chevron-down":!e.isTableVisible,"icon-chevron-up":e.isTableVisible}])},null,2)])])])],8,p),t[17]||(t[17]=(0,o.eW)()),(0,o.bo)((0,o.Lk)("tbody",null,[t[15]||(t[15]=(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"\n                Resource\n              "),(0,o.eW)(),(0,o.Lk)("th",null,"\n                Count\n              "),(0,o.eW)(),(0,o.Lk)("th",null,"\n                Resource Timing (ms)\n              ")],-1)),t[16]||(t[16]=(0,o.eW)()),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.counts,((e,a)=>((0,o.uX)(),(0,o.CE)("tr",{key:a},[e.count>0?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("td",b,(0,s.v_)(e.resource),1),t[13]||(t[13]=(0,o.eW)()),(0,o.Lk)("td",null,(0,s.v_)(e.count),1),t[14]||(t[14]=(0,o.eW)()),(0,o.Lk)("td",null,(0,s.v_)(e.durationMs||"-"),1)],64)):(0,o.Q3)("",!0)])))),128))],512),[[n.aG,e.isTableVisible]])])))),128))])])])}var v=a(55823),y=a(97671),k=a(50961),w=a(43399),C=a(18561);const L={name:"Diagnostic",components:{AsyncButton:y.A},async fetch(){const e=await this.$store.dispatch("management/findAll",{type:v.qt.RANCHER_CLUSTER}),t=e.filter((e=>e.mgmt?.isReady)),a=(0,w.uY)((0,w.WJ)(t,this.$store),this.$store),o=[],s=[],n=[];a.forEach(((e,t)=>{const n=this.$store.getters["management/byId"](v.Mc.CLUSTER,e.metadata.name);o.push({id:e.id,name:n?.spec?.displayName||e.metadata?.name,namespace:e.metadata?.namespace,capiId:e.mgmt?.id,counts:null,isTableVisible:!(0!==t||1!==a.length)}),s.push(this.$store.dispatch("management/request",{url:`/k8s/clusters/${e.mgmt?.id}/v1/counts`}))}));const i=await Promise.all(s);i.forEach(((e,t)=>{const a=e.data?.[0]?.counts;if(a){const e=[];let s=[];Object.keys(a).forEach((t=>{e[t]=a[t].summary?.count,e.push({resource:t,count:a[t].summary?.count||0})}));const i=(0,C.Ul)(e,"count:desc");s=s.concat(i),s=(0,C.Ul)(s,"count:desc"),s=s.splice(0,15),s.forEach(((e,a)=>{s[a].id=o[t].id,s[a].capiId=o[t].capiId})),n.push(s),o[t].counts=i}})),this.topFifteenForResponseTime=n,this.finalCounts=o},data(){const{userAgent:e,userAgentData:t,language:a,cookieEnabled:o,hardwareConcurrency:s,deviceMemory:n}=window?.navigator,i={browser:{label:this.t("about.diagnostic.systemInformation.browser"),value:this.t("about.diagnostic.systemInformation.browserInfo",{userAgent:e,language:a,cookieEnabled:o})},system:{label:this.t("about.diagnostic.systemInformation.system"),value:this.t("about.diagnostic.systemInformation.hardwareConcurrency",{hardwareConcurrency:s})},jsMemory:{label:this.t("about.diagnostic.systemInformation.jsMemory"),value:""}};return t?.platform&&(i.system.value=i.system.value.concat(", ",this.t("about.diagnostic.systemInformation.os",{platform:t.platform}))),n&&(i.system.value=i.system.value.concat(", ",this.t("about.diagnostic.systemInformation.deviceMemory",{deviceMemory:n}))),window?.performance?.memory?.jsHeapSizeLimit&&(i.jsMemory.value+=this.t("about.diagnostic.systemInformation.memJsHeapLimit",{jsHeapSizeLimit:window?.performance?.memory?.jsHeapSizeLimit})),window?.performance?.memory?.totalJSHeapSize&&(i.jsMemory.value+=`, ${this.t("about.diagnostic.systemInformation.memTotalJsHeapSize",{totalJSHeapSize:window?.performance?.memory?.totalJSHeapSize})}`),window?.performance?.memory?.usedJSHeapSize&&(i.jsMemory.value+=`, ${this.t("about.diagnostic.systemInformation.memUsedJsHeapSize",{usedJSHeapSize:window?.performance?.memory?.usedJSHeapSize})}`),{systemInformation:i,topFifteenForResponseTime:null,responseTimes:null,finalCounts:null,includeResponseTimes:!0,storeMapping:this.$store?._modules?.root?.state}},computed:{clusterCount(){return this.finalCounts?.length}},methods:{generateKey(e){const t=1e4*Math.random();return`key_${t}_${e}`},downloadData(e){const t="rancher-diagnostic-data.json",a={systemInformation:this.systemInformation,storeMapping:this.parseStoreData(this.storeMapping),resourceCounts:this.finalCounts,responseTimes:this.responseTimes};(0,k.PE)(t,JSON.stringify(a),"application/json").then((()=>e(!0))).catch((()=>e(!1)))},setResourceResponseTiming(e){e?.forEach((e=>{if("success"===e.outcome){const t=this.finalCounts.find((t=>t.capiId===e.item.capiId)),a=t?.counts?.findIndex((t=>t.resource===e.item.resource));(a&&-1!==a||0===a)&&(t.counts[a]["durationMs"]=e.durationMs)}}))},sumResourceCount(e){return e.reduce(((e,t)=>e+t.count),0)},nodeCount(e){const t=e.findIndex((e=>"node"===e.resource));return e[t]?.count},toggleTable(e){const t=this.finalCounts.findIndex((t=>t.id===e));this.finalCounts[t].isTableVisible=!this.finalCounts[t].isTableVisible},async gatherResponseTimes(e){const t=this.topFifteenForResponseTime.flatMap((e=>e.map((e=>{const t=Date.now();return this.$store.dispatch("management/request",{url:`/k8s/clusters/${e.capiId}/v1/${e.resource}`}).then((()=>({outcome:"success",item:e,durationMs:Date.now()-t}))).catch((()=>({outcome:"error",item:e,durationMs:Date.now()-t})))}))));return await Promise.all(t).then((t=>{this.responseTimes=t,this.setResourceResponseTiming(t),e(!0)})).catch((()=>e(!1)))},parseStoreData(e){const t=["aws","digitalocean","linode","targetRoute","$router","$route"],a=["management","rancher","cluster","harvester","epinio","elemental"],o={};return Object.entries(e).forEach((([e,s])=>{t.includes(e)||(a.includes(e)&&Object.keys(s.types||{}).length?(o[e]={...s,types:{}},Object.entries(s.types).forEach((([t,a])=>{const{list:s,...n}=a;o[e].types[t]={...n,count:s.length}}))):o[e]=s)})),o},promptDownload(e){this.responseTimes?this.downloadData(e):this.$store.dispatch("management/promptModal",{component:"DiagnosticTimingsDialog",componentProps:{downloadData:this.downloadData,gatherResponseTimes:this.gatherResponseTimes}}).then((()=>e(!0))).catch((()=>e(!1)))}}};a(54014);var I=a(66262);const T=(0,I.A)(L,[["render",g],["__scopeId","data-v-5a6f39f4"]]),x=T},33156:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var o=a(31601),s=a.n(o),n=a(76314),i=a.n(n),r=a(5111),l=i()(s());l.i(r.A),l.push([e.id,".title-block[data-v-5a6f39f4]{display:flex;justify-content:right;align-items:center}.title-block h1[data-v-5a6f39f4]{margin:0!important}.title-block div[data-v-5a6f39f4]{display:flex;align-items:center}table[data-v-5a6f39f4]{border-collapse:collapse;overflow:hidden;border-radius:var(--border-radius)}table.full-width[data-v-5a6f39f4]{border-radius:0!important;min-width:60%}table.full-width thead[data-v-5a6f39f4]{cursor:pointer}table.full-width thead th div[data-v-5a6f39f4]{display:flex;align-items:center;justify-content:space-between}table.full-width tbody[data-v-5a6f39f4]{border-bottom:1px solid var(--sortable-table-top-divider)}table tr>td[data-v-5a6f39f4]:first-of-type{width:20%}table td[data-v-5a6f39f4],table th[data-v-5a6f39f4]{border:1px solid var(--border);padding:8px 5px;min-width:150px;text-align:left}table th[data-v-5a6f39f4]{background-color:var(--sortable-table-top-divider);border-bottom:1px solid var(--sortable-table-header-bg)}table a[data-v-5a6f39f4]{cursor:pointer}table .os[data-v-5a6f39f4]{display:flex;align-items:center}.logs-container[data-v-5a6f39f4]{list-style:none;margin:0;padding:0;background-color:#fff;border:1px solid var(--body-text);height:300px;overflow-x:hidden;overflow-y:auto}.logs-container li[data-v-5a6f39f4]{font-family:Roboto Mono,monospace;font-size:12px;margin:0;padding:10px 20px;border-bottom:1px solid #ccc}.logs-container li.log[data-v-5a6f39f4]{color:#000}.logs-container li.warn[data-v-5a6f39f4]{background-color:#fafad2;color:#8b4513}.logs-container li.info[data-v-5a6f39f4]{background-color:azure;color:blue}.logs-container li.error[data-v-5a6f39f4]{background-color:#ffe4e1;color:red}.logs-container li[data-v-5a6f39f4]:last-child{border-bottom:none}.logs-container li .log-entry-type[data-v-5a6f39f4]{font-weight:700}.resources-count-container .cluster-row[data-v-5a6f39f4]{display:grid;grid-template-columns:repeat(4,1fr) 20px;grid-template-rows:1fr;align-content:center;font-weight:400}.resources-count-container tbody tr[data-v-5a6f39f4],.resources-count-container tbody tr th[data-v-5a6f39f4]{background-color:var(--sortable-table-header-bg)}.resources-count-container tbody tr th[data-v-5a6f39f4]{border-bottom:1px solid var(--sortable-table-top-divider)}.resources-count-container tbody tr[data-v-5a6f39f4]:hover{background-color:var(--sortable-table-top-divider)}",""]);const c=l},54014:(e,t,a)=>{var o=a(33156);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var s=a(99548).A;s("49da7a09",o,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=5846.74ef4d12.js.map