(self["webpackChunkui_plugin_examples"]=self["webpackChunkui_plugin_examples"]||[]).push([[4637],{49682:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>w});var r=s(20641),a=s(90033);const n={class:"text-default-text"},o={class:"pl-10 pr-10"},l={key:0},c={key:0,class:"pt-10 pb-10"},i={class:"buttons"};function p(t,e,s,p,u,d){const h=(0,r.g2)("Banner"),y=(0,r.g2)("AsyncButton"),f=(0,r.g2)("Card"),k=(0,r.gN)("clean-html");return(0,r.uX)(),(0,r.Wv)(f,{class:"prompt-rotate","show-highlight-border":!1},{title:(0,r.k6)((()=>[(0,r.bo)((0,r.Lk)("h4",n,null,512),[[k,t.t("promptRotateEncryptionKey.title")]])])),body:(0,r.k6)((()=>[(0,r.Lk)("div",o,[(0,r.bF)(h,{color:"warning","label-key":"promptRotateEncryptionKey.warning"}),e[1]||(e[1]=(0,r.eW)()),t.$fetchState.pending?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",l,[u.latestBackup?((0,r.uX)(),(0,r.CE)("p",c,(0,a.v_)(t.t("promptRotateEncryptionKey.description",u.latestBackup,!0)),1)):((0,r.uX)(),(0,r.Wv)(h,{key:1,color:"error","label-key":"promptRotateEncryptionKey.error"}))]))])])),actions:(0,r.k6)((()=>[(0,r.Lk)("div",i,[(0,r.Lk)("button",{class:"btn role-secondary mr-10",onClick:e[0]||(e[0]=(...t)=>d.close&&d.close(...t))},(0,a.v_)(t.t("generic.cancel")),1),e[2]||(e[2]=(0,r.eW)()),(0,r.bF)(y,{mode:"rotate",disabled:t.$fetchState.pending||!u.latestBackup,onClick:d.apply},null,8,["disabled","onClick"]),e[3]||(e[3]=(0,r.eW)()),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.errors,((t,e)=>((0,r.uX)(),(0,r.Wv)(h,{key:e,color:"error",label:t},null,8,["label"])))),128))])])),_:1,__:[4,5]})}var u=s(55823),d=s(97671),h=s(75672),y=s(14492),f=s(37447),k=s(18561),g=s(74353),m=s.n(g),b=s(72140),v=s(86691),C=s(6826);const _={emits:["close"],components:{Card:h.Z,AsyncButton:d.A,Banner:y.l},props:{cluster:{type:Object,default:()=>({})}},async fetch(){if(!this.$store.getters["isRancher"])return[];const t=await this.getEtcdBackups();if(t.length>0){const e=(0,k.Ul)(t,["created"]).reverse(),s=e[0].id.split(":"),r=e[0].created;this.latestBackup={name:s[0],date:this.getFormattedCreatedDate(r)}}},data(){return{errors:[],latestBackup:null}},methods:{close(t){t&&"function"===typeof t&&t(!0),this.$emit("close")},async getEtcdBackups(){if(this.cluster.isRke1){let t=await this.$store.dispatch("rancher/findAll",{type:u.k$.ETCD_BACKUP});return t=t.filter((t=>t.clusterId===this.cluster.metadata.name)),t}if(this.cluster.isRke2){let t=await this.$store.dispatch("management/findAll",{type:u.xO});return t=t.filter((t=>t.clusterId===this.cluster.id)),t}return[]},getFormattedCreatedDate(t){const e=(0,b.ZD)(this.$store.getters["prefs/get"](v.DATE_FORMAT)),s=(0,b.ZD)(this.$store.getters["prefs/get"](v.TIME_FORMAT)),r=m()(t).format(e),a=m()(t).format(s);return`${r} ${a}`},async apply(t){const e=this.cluster.isRke2;try{if(e){const e=this.cluster.spec?.rkeConfig?.rotateEncryptionKeys?.generation||0;(0,C.set)(this.cluster,"spec.rkeConfig.rotateEncryptionKeys.generation",e+1),await this.cluster.save(),this.close(t)}else await this.cluster.mgmt.doAction("rotateEncryptionKey"),this.close(t)}catch(s){this.errors=(0,f.rz)(s),t(!1)}}}};s(74886);var E=s(66262);const A=(0,E.A)(_,[["render",p],["__scopeId","data-v-697436f3"]]),w=A},37448:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>i});var r=s(31601),a=s.n(r),n=s(76314),o=s.n(n),l=s(5111),c=o()(a());c.i(l.A),c.push([t.id,".prompt-rotate[data-v-697436f3]{margin:0}.buttons[data-v-697436f3]{display:flex;justify-content:flex-end;width:100%}",""]);const i=c},74886:(t,e,s)=>{var r=s(37448);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);var a=s(99548).A;a("83d95c62",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=dialog24.ae1bd532.js.map